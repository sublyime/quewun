<UserControl x:Class="DataQuillDesktop.Views.TerminalView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewmodels="clr-namespace:DataQuillDesktop.ViewModels">
    <UserControl.DataContext>
        <viewmodels:TerminalViewModel/>
    </UserControl.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="#2D2D30"
                Padding="15">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ’»"
                           FontSize="20"
                           Margin="0,0,10,0"
                           VerticalAlignment="Center"/>
                <TextBlock Text="Terminal"
                           FontSize="16"
                           FontWeight="Bold"
                           Foreground="White"
                           VerticalAlignment="Center"/>
                <TextBlock Text="SSH, Telnet, and Raw Terminal Connections"
                           FontSize="12"
                           Foreground="LightGray"
                           Margin="15,0,0,0"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1"
              Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Connections -->
            <Border Grid.Column="0"
                    BorderBrush="LightGray"
                    BorderThickness="1"
                    Background="White">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Connection Type Selector -->
                    <Border Grid.Row="0"
                            Background="#F5F5F5"
                            Padding="10"
                            BorderBrush="LightGray"
                            BorderThickness="0,0,0,1">
                        <StackPanel>
                            <TextBlock Text="New Connection Type:"
                                       FontWeight="Bold"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding ConnectionTypes}"
                                      SelectedItem="{Binding SelectedConnectionType}"
                                      DisplayMemberPath="."
                                      Margin="0,0,0,10"/>
                            <Button Content="Add Connection"
                                    Command="{Binding AddConnectionCommand}"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="8,4"/>
                        </StackPanel>
                    </Border>

                    <!-- Active Sessions -->
                    <Border Grid.Row="1"
                            Background="#E8F5E8"
                            Padding="10"
                            BorderBrush="LightGray"
                            BorderThickness="0,0,0,1">
                        <StackPanel>
                            <TextBlock Text="Active Sessions:"
                                       FontWeight="Bold"
                                       Margin="0,0,0,5"/>
                            <ListBox ItemsSource="{Binding ActiveSessions}"
                                     SelectedItem="{Binding SelectedSession}"
                                     MaxHeight="120"
                                     Background="Transparent"
                                     BorderThickness="0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="8"
                                                     Height="8"
                                                     Fill="Green"
                                                     Margin="0,0,5,0"
                                                     VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding ConnectionName}"
                                                       FontWeight="Bold"/>
                                            <TextBlock Text="{Binding ConnectionType, StringFormat=' ({0})'}"
                                                       Foreground="Gray"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </StackPanel>
                    </Border>

                    <!-- Connections List -->
                    <ListBox Grid.Row="2"
                             ItemsSource="{Binding Connections}"
                             SelectedItem="{Binding SelectedConnection}"
                             Margin="5">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8"
                                        Margin="2"
                                        Background="White"
                                        BorderBrush="LightGray"
                                        BorderThickness="1">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Name}"
                                                       FontWeight="Bold"
                                                       Margin="0,0,5,0"/>
                                            <Border Background="{Binding Status, Converter={StaticResource StatusColorConverter}}"
                                                    CornerRadius="2"
                                                    Padding="4,1">
                                                <TextBlock Text="{Binding Status}"
                                                           Foreground="White"
                                                           FontSize="10"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding ConnectionType}"
                                                   FontSize="11"
                                                   Foreground="Gray"/>
                                        <TextBlock Text="{Binding Description}"
                                                   FontSize="10"
                                                   Foreground="DarkGray"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- Connection Actions -->
                    <Border Grid.Row="3"
                            Background="#F5F5F5"
                            Padding="10"
                            BorderBrush="LightGray"
                            BorderThickness="0,1,0,0">
                        <StackPanel>
                            <Button Content="Connect"
                                    Command="{Binding ConnectCommand}"
                                    Background="#2196F3"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="8,4"
                                    Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Edit"
                                        Command="{Binding EditConnectionCommand}"
                                        Background="#FF9800"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="8,4"
                                        Width="70"
                                        Margin="0,0,5,0"/>
                                <Button Content="Remove"
                                        Command="{Binding RemoveConnectionCommand}"
                                        Background="#F44336"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="8,4"
                                        Width="70"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1"
                          Width="5"
                          Background="LightGray"
                          HorizontalAlignment="Stretch"/>

            <!-- Right Panel - Connection Details and Terminal -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Connection Details Panel -->
                <Border Grid.Row="0"
                        BorderBrush="LightGray"
                        BorderThickness="1"
                        Background="White"
                        Margin="0,0,0,5">
                    <Expander Header="Connection Details"
                              IsExpanded="True"
                              Padding="10">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      MaxHeight="200">
                            <StackPanel DataContext="{Binding SelectedConnection}">
                                <!-- Common Fields -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Name:"
                                               Grid.Column="0"
                                               VerticalAlignment="Center"
                                               FontWeight="Bold"/>
                                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                             Grid.Column="1"
                                             Margin="5,0,0,0"/>
                                </Grid>

                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Description:"
                                               Grid.Column="0"
                                               VerticalAlignment="Center"
                                               FontWeight="Bold"/>
                                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                             Grid.Column="1"
                                             Margin="5,0,0,0"/>
                                </Grid>

                                <!-- SSH Connection Fields -->
                                <StackPanel Visibility="{Binding ConnectionType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=SSH}">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Host:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Hostname, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,5,0"/>
                                        <TextBlock Text="Port:"
                                                   Grid.Column="2"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="3"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Username:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Auth Type:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <ComboBox ItemsSource="{Binding DataContext.AuthenticationTypes, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                  SelectedItem="{Binding AuthenticationType}"
                                                  Grid.Column="1"
                                                  Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5"
                                          Visibility="{Binding AuthenticationType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Password}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Password:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <PasswordBox Name="SshPasswordBox"
                                                     Grid.Column="1"
                                                     Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5"
                                          Visibility="{Binding AuthenticationType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=PrivateKey}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Private Key:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding PrivateKeyPath, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,5,0"/>
                                        <Button Content="Browse"
                                                Grid.Column="2"
                                                Padding="5,2"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Telnet Connection Fields -->
                                <StackPanel Visibility="{Binding ConnectionType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Telnet}">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Host:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Hostname, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,5,0"/>
                                        <TextBlock Text="Port:"
                                                   Grid.Column="2"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="3"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Username:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Password:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <PasswordBox Name="TelnetPasswordBox"
                                                     Grid.Column="1"
                                                     Margin="5,0,0,0"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Raw TCP Connection Fields -->
                                <StackPanel Visibility="{Binding ConnectionType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=RawTcp}">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Host:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Hostname, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,5,0"/>
                                        <TextBlock Text="Port:"
                                                   Grid.Column="2"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="3"
                                                 Margin="5,0,0,0"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Serial Connection Fields -->
                                <StackPanel Visibility="{Binding ConnectionType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Serial}">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Port:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding PortName, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,5,0"/>
                                        <TextBlock Text="Baud:"
                                                   Grid.Column="2"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding BaudRate, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="3"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Data Bits:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding DataBits, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,5,0"/>
                                        <TextBlock Text="Parity:"
                                                   Grid.Column="2"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <ComboBox SelectedItem="{Binding Parity}"
                                                  Grid.Column="3"
                                                  Margin="5,0,5,0">
                                            <ComboBoxItem Content="None"/>
                                            <ComboBoxItem Content="Odd"/>
                                            <ComboBoxItem Content="Even"/>
                                            <ComboBoxItem Content="Mark"/>
                                            <ComboBoxItem Content="Space"/>
                                        </ComboBox>
                                        <StackPanel Grid.Column="4"
                                                    Orientation="Horizontal"
                                                    Margin="5,0,0,0">
                                            <CheckBox Content="DTR"
                                                    IsChecked="{Binding DtrEnable}"
                                                    Margin="0,0,10,0"/>
                                            <CheckBox Content="RTS"
                                                    IsChecked="{Binding RtsEnable}"/>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Stop Bits:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <ComboBox SelectedItem="{Binding StopBits}"
                                                  Grid.Column="1"
                                                  Margin="5,0,0,0">
                                            <ComboBoxItem Content="None"/>
                                            <ComboBoxItem Content="One"/>
                                            <ComboBoxItem Content="Two"/>
                                            <ComboBoxItem Content="OnePointFive"/>
                                        </ComboBox>
                                    </Grid>
                                </StackPanel>

                                <!-- Local Shell Connection Fields -->
                                <StackPanel Visibility="{Binding ConnectionType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=LocalShell}">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Shell Path:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding ShellPath, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Arguments:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding Arguments, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,0,0"/>
                                    </Grid>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Working Dir:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <TextBox Text="{Binding WorkingDirectory, UpdateSourceTrigger=PropertyChanged}"
                                                 Grid.Column="1"
                                                 Margin="5,0,0,0"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Data Stream Monitor Fields -->
                                <StackPanel Visibility="{Binding ConnectionType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=DataStreamMonitor}">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Cloud Conn:"
                                                   Grid.Column="0"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"/>
                                        <ComboBox ItemsSource="{Binding DataContext.CloudConnections, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                  SelectedValue="{Binding CloudConnectionId}"
                                                  SelectedValuePath="Id"
                                                  DisplayMemberPath="Name"
                                                  Grid.Column="1"
                                                  Margin="5,0,0,0"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Expander>
                </Border>

                <!-- Terminal Panel -->
                <Grid Grid.Row="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Terminal Header -->
                    <Border Grid.Row="0"
                            Background="#1E1E1E"
                            Padding="10">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding SelectedSession.ConnectionName, FallbackValue='No Active Session'}"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SelectedSession.ConnectionType, StringFormat=' - {0}', FallbackValue=''}"
                                       Foreground="LightGray"
                                       VerticalAlignment="Center"/>
                            <Button Content="Disconnect"
                                    Command="{Binding DisconnectCommand}"
                                    Background="#F44336"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="6,2"
                                    Margin="20,0,0,0"
                                    FontSize="10"/>
                            <Button Content="Clear"
                                    Command="{Binding ClearTerminalCommand}"
                                    Background="#757575"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="6,2"
                                    Margin="5,0,0,0"
                                    FontSize="10"/>
                        </StackPanel>
                    </Border>

                    <!-- Terminal Output -->
                    <Border Grid.Row="1"
                            Background="#0C0C0C"
                            BorderBrush="Gray"
                            BorderThickness="1">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding SelectedSession.Messages}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="2,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Timestamp, StringFormat='[HH:mm:ss] '}"
                                                           Foreground="Gray"
                                                           FontFamily="Consolas"
                                                           FontSize="10"/>
                                                <TextBlock Text="{Binding Content}"
                                                           Foreground="{Binding Type, Converter={StaticResource MessageTypeColorConverter}}"
                                                           FontFamily="Consolas"
                                                           FontSize="12"
                                                           TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>

                    <!-- Command Input -->
                    <Border Grid.Row="2"
                            Background="#1E1E1E"
                            Padding="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Text="{Binding InputCommand, UpdateSourceTrigger=PropertyChanged}"
                                     Background="#2D2D30"
                                     Foreground="White"
                                     BorderBrush="Gray"
                                     BorderThickness="1"
                                     FontFamily="Consolas"
                                     Padding="5"
                                     VerticalAlignment="Center">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter"
                                                Command="{Binding SendCommandCommand}"/>
                                </TextBox.InputBindings>
                            </TextBox>

                            <Button Grid.Column="1"
                                    Content="Send"
                                    Command="{Binding SendCommandCommand}"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="15,5"
                                    Margin="5,0,0,0"/>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</UserControl>